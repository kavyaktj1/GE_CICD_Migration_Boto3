{"StartAt": "UPDATE SNAPSHOT LAMBDA", "States": {"UPDATE SNAPSHOT LAMBDA": {"Type": "Task", "InputPath": "$", "ResultPath": "$.CHECK SNAPSHOT LAMBDA", "Parameters": {"DDB_KEY_TO_UPDATE": "contigency_c"}, "Resource": "arn:aws:lambda:us-east-1:541574621075:function:mapp_snapshot_lock", "Next": "CHECK SNAPSHOT LAMBDA"}, "CHECK SNAPSHOT LAMBDA": {"Type": "Task", "InputPath": "$", "ResultPath": "$.CDS_SNAPSHOT_GLPROD_CONTINGENCY", "Parameters": {"DDB_KEY_TO_UPDATE": "contigency_c_check"}, "Resource": "arn:aws:lambda:us-east-1:541574621075:function:mapp_snapshot_lock", "Catch": [{"ErrorEquals": ["ZeroDivisionError"], "Next": "SKIP CDS_SNAPSHOT_GLPROD_CONTINGENCY"}], "Next": "LOAD CDS_SNAPSHOT_GLPROD_CONTINGENCY"}, "LOAD CDS_SNAPSHOT_GLPROD_CONTINGENCY": {"Type": "Task", "InputPath": "$", "ResultPath": "$.CDS_SNAPSHOT_GLPROD_CONTINGENCY", "Resource": "arn:aws:states:::glue:startJobRun.sync", "Parameters": {"JobName": "job_mrr_entity_cds_rs_proc", "Arguments": {"--rs_proc_name": "hdl_services_sp.sp_backorders_cds_snapshot_f_glprod_contingency(1)"}}, "Retry": [{"ErrorEquals": ["States.Timeout"], "MaxAttempts": 3, "IntervalSeconds": 60, "BackoffRate": 2}], "Catch": [{"ErrorEquals": ["States.TaskFailed"], "Next": "SNS_CDS_SNAPSHOT_GLPROD_CONTINGENCY_FAILED"}], "Next": "REFRESH SPOTFIRE COMBINED ORDERS"}, "SNS_CDS_SNAPSHOT_GLPROD_CONTINGENCY_FAILED": {"Type": "Task", "Resource": "arn:aws:states:::sns:publish", "Parameters": {"TopicArn": "arn:aws:sns:us-east-1:541574621075:ODP_SFN_FAILURE", "Message.$": "$.Cause", "Subject": "AWS GLUE SHELL JOB FOR CDS_SNAPSHOT_GLPROD_CONTINGENCY FAILED!"}, "End": false}, "REFRESH SPOTFIRE COMBINED ORDERS": {"Type": "Task", "InputPath": "$", "ResultPath": "$", "Parameters": {"REPORT_LOCATION": "/Service Data Analytics/Parts Analytics/Release 2/Analysis/MVP Gap Release/BO Segmentation-Combined Orders"}, "Resource": "arn:aws:lambda:us-east-1:541574621075:function:odp-spotfire-refresh", "Retry": [{"ErrorEquals": ["States.Timeout"], "MaxAttempts": 3, "IntervalSeconds": 5, "BackoffRate": 2}], "Next": "REFRESH SPOTFIRE DEMAND ORDERS", "Catch": [{"ErrorEquals": ["States.TaskFailed"], "Next": "SNS FAILED COMBINED ORDERS LAMBDA"}]}, "REFRESH SPOTFIRE DEMAND ORDERS": {"Type": "Task", "InputPath": "$", "ResultPath": "$", "Parameters": {"REPORT_LOCATION": "/Service Data Analytics/Parts Analytics/Release 2/Analysis/MVP Gap Release/BO Segmentation-Customer Demand Orders"}, "Resource": "arn:aws:lambda:us-east-1:541574621075:function:odp-spotfire-refresh", "Retry": [{"ErrorEquals": ["States.Timeout"], "MaxAttempts": 3, "IntervalSeconds": 5, "BackoffRate": 2}], "Next": "LOAD GLPROD_CONTINGENCY_BACKFILL", "Catch": [{"ErrorEquals": ["States.TaskFailed"], "Next": "SNS FAILED DEMAND ORDERS LAMBDA"}]}, "SNS FAILED COMBINED ORDERS LAMBDA": {"Type": "Task", "Resource": "arn:aws:states:::sns:publish", "Parameters": {"TopicArn": "arn:aws:sns:us-east-1:541574621075:ODP_SFN_FAILURE", "Message.$": "$.Cause", "Subject": "Spotfire refresh failed for COMBINED ORDERS"}, "Next": "REFRESH SPOTFIRE DEMAND ORDERS"}, "SNS FAILED DEMAND ORDERS LAMBDA": {"Type": "Task", "Resource": "arn:aws:states:::sns:publish", "Parameters": {"TopicArn": "arn:aws:sns:us-east-1:541574621075:ODP_SFN_FAILURE", "Message.$": "$.Cause", "Subject": "Spotfire refresh failed for COMBINED ORDERS"}, "Next": "LOAD GLPROD_CONTINGENCY_BACKFILL"}, "SKIP CDS_SNAPSHOT_GLPROD_CONTINGENCY": {"Type": "Pass", "Next": "UPDATE DYNAMODB FOR CONTINGENCY_FLAG"}, "LOAD GLPROD_CONTINGENCY_BACKFILL": {"Type": "Task", "Resource": "arn:aws:states:::glue:startJobRun.sync", "Parameters": {"JobName": "job_mrr_entity_cds_rs_proc", "Arguments": {"--rs_proc_name": "hdl_services_sp.sp_backorders_cds_snapshot_f_glprod_backfill(7)"}}, "Retry": [{"ErrorEquals": ["States.Timeout"], "MaxAttempts": 3, "IntervalSeconds": 60, "BackoffRate": 2}], "Catch": [{"ErrorEquals": ["States.TaskFailed"], "Next": "SNS_GLPROD_CONTINGENCY_BACKFILL_FAILED"}], "Next": "PASS GLPROD_CONTINGENCY_BACKFILL"}, "SNS_GLPROD_CONTINGENCY_BACKFILL_FAILED": {"Type": "Task", "Resource": "arn:aws:states:::sns:publish", "Parameters": {"TopicArn": "arn:aws:sns:us-east-1:541574621075:ODP_SFN_FAILURE", "Message.$": "$.Cause", "Subject": "AWS GLUE SHELL JOB FORGLPROD_CONTINGENCY_BACKFILL FAILED!"}, "Next": "UPDATE DYNAMODB FOR CONTINGENCY_FLAG"}, "PASS GLPROD_CONTINGENCY_BACKFILL": {"Type": "Pass", "Next": "UPDATE DYNAMODB FOR CONTINGENCY_FLAG"}, "UPDATE DYNAMODB FOR CONTINGENCY_FLAG": {"Type": "Task", "Parameters": {"DDB_KEY_TO_UPDATE": "contingency_finished_flag", "DDB_FLAG": "Y"}, "Resource": "arn:aws:lambda:us-east-1:541574621075:function:mapp_daily_run_schedule_update", "Next": "SNS_GLPROD_CONTINGENCY_BACKFILL_SUCCESS"}, "SNS_GLPROD_CONTINGENCY_BACKFILL_SUCCESS": {"Type": "Task", "Resource": "arn:aws:states:::sns:publish", "Parameters": {"TopicArn": "arn:aws:sns:us-east-1:541574621075:ODP_SFN_SUCCESS", "Message": {"Subject": "AWS Step function for SNS_GLPROD_CONTINGENCY_BACKFILL_SUCCESS completed successfully!!"}}, "End": true}}}